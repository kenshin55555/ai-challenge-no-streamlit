<!--
  ==============================================================================
  FILE: index.html
  
  DESCRIPTION:
    Main HTML file for the Stocktrader Agent chat application. This file 
    defines the structure for both the primary chat interface and the secondary,
    hidden analysis view. It loads Tailwind CSS for styling and the application's
    core logic from app.js.
  ==============================================================================
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stocktrader Agent</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js" defer></script>
    
    <!-- Fonts and Styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/js/style.css">
    <link rel="stylesheet" href="/static/js/style.css">

    <!-- Custom Page Styles -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        #messages::-webkit-scrollbar, 
        #analysis-content::-webkit-scrollbar { width: 6px; }
        #messages::-webkit-scrollbar-track, 
        #analysis-content::-webkit-scrollbar-track { background: #f1f5f9; }
        #messages::-webkit-scrollbar-thumb, 
        #analysis-content::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 3px; }
        #messages::-webkit-scrollbar-thumb:hover, 
        #analysis-content::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .message-bubble { max-width: 75%; word-wrap: break-word; } 
        .dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; }
    </style>
</head>

<body class="bg-gray-100 flex items-center justify-center h-screen">

    <div class="w-full max-w-4xl h-full md:h-[95vh] bg-white shadow-2xl rounded-xl flex flex-col" id="chat-wrapper">

        <!-- ====================================================================== -->
        <!-- Main Chat View (Initially Visible)                                     -->
        <!-- ====================================================================== -->
        <div id="main-chat-view" class="w-full h-full flex flex-col">
            
            <!-- Header Section -->
            <header class="bg-blue-800 text-white p-4 rounded-t-xl flex items-center justify-between shadow-md">
                <div class="flex items-center">
                    <div class="w-12 h-12 bg-gradient-to-tr from-purple-500 to-blue-500 rounded-full flex items-center justify-center mr-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-semibold">Stocktrader Agent</h1>
                        <div class="flex items-center space-x-2">
                            <span id="status-dot" class="dot bg-yellow-400 animate-pulse"></span>
                            <p id="status-text" class="text-sm text-gray-300">Connecting...</p>
                        </div>
                    </div>
                </div>
                <button id="analysis-view-btn" class="px-3 py-2 bg-white/20 text-sm font-medium text-white rounded-lg shadow hover:bg-white/40 focus:outline-none">Analysis View</button>
            </header>

            <!-- Message Display Area -->
            <main id="messages" class="flex-1 p-6 overflow-y-auto bg-gray-50">
                 <!-- Messages are dynamically populated by app.js -->
            </main>

            <!-- User Input Section -->
            <footer class="p-4 bg-white border-t border-gray-200 rounded-b-xl">
                <form id="messageForm" class="flex items-center space-x-4">
                    <input type="text" id="message" name="message" placeholder="Type your message..." autocomplete="off" class="flex-1 p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition" >
                    <button type="submit" id="sendButton" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-300 ease-in-out transform hover:scale-105" >
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                    </button>
                </form>
            </footer>
        </div>

        <!-- ====================================================================== -->
        <!-- Analysis View (Initially Hidden)                                       -->
        <!-- ====================================================================== -->
        <div id="analysis-view" class="w-full h-full flex-col hidden p-6 bg-gray-50">
            
            <!-- Analysis Header -->
            <div class="flex justify-between items-start mb-4">
                <div>
                    <h2 id="analysis-title" class="text-2xl font-bold text-slate-800"></h2>
                    <p class="text-sm text-slate-500">Updated <span id="analysis-date"></span></p>
                </div>
                <button id="chat-view-btn" class="px-3 py-2 bg-white text-sm font-medium text-slate-700 rounded-lg shadow hover:bg-gray-200 focus:outline-none">Chat View</button>
            </div>

            <!-- Summary Cards Section -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-red-100 border border-red-200 p-4 rounded-lg">
                    <p class="text-sm text-red-600 font-semibold">CONTRADICTIONS</p>
                    <p id="contradictions-count" class="text-3xl font-bold text-red-800"></p>
                    <p class="text-sm text-slate-600">Medium opposition</p>
                </div>
                <div class="bg-green-100 border border-green-200 p-4 rounded-lg">
                    <p class="text-sm text-green-600 font-semibold">CONFIRMATIONS</p>
                    <p id="confirmations-count" class="text-3xl font-bold text-green-800"></p>
                    <p class="text-sm text-slate-600">Weak support</p>
                </div>
                <div class="bg-blue-100 border border-blue-200 p-4 rounded-lg">
                    <p class="text-sm text-blue-600 font-semibold">CONFIDENCE</p>
                    <p id="confidence-score" class="text-3xl font-bold text-blue-800"></p>
                    <div class="w-full bg-slate-200 rounded-full h-2.5 mt-2">
                        <div id="confidence-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <!-- Detailed Analysis Section -->
            <div id="analysis-content" class="flex-1 grid grid-cols-1 md:grid-cols-2 gap-6 overflow-y-auto">
                <div id="contradictions-list"></div>
                <div id="confirmations-list"></div>
            </div>
        </div>
    </div>
    
    <!-- Application Script: Placed at the end of the body for reliable DOM access. -->
    <script src="/static/js/app.js"></script> 
</body>
</html>
